@using System
@using System.Collections.Generic
@using System.Linq
@using System.Text
@using System.IO
@using RazorEngine
@using RazorEngine.Templating
@using DatabaseSchemaReader
@using DatabaseSchemaReader.DataSchema

@inherits RazorEngine.Templating.Code4UTemplateBase<DatabaseSchemaReader.DataSchema.DatabaseSchema>

@{ 
    var filename = Path.Combine(ViewBag.TemplateFolder, @"Models\__NAME__.cs.cshtml"); 

    foreach (var table in Model.Tables)
    {
        var generatedCode = Include(filename, table, typeof(DatabaseTable)).ToString();

        var generatedFileName = filename.Replace(ViewBag.TemplateFolder + "\\", string.Empty)
                                        .Replace("__NAME__", table.Name)
                                        .Replace(".cshtml", string.Empty);

        generatedFileName = Path.Combine(ViewBag.GeneratedCodeFolder, generatedFileName);

        var generationDirectory = Path.GetDirectoryName(generatedFileName);

        if (!Directory.Exists(generationDirectory))
        {
            Directory.CreateDirectory(generationDirectory);
        }

        File.WriteAllText(generatedFileName, generatedCode);
    }
}
